(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-20e1c19c"],{"9f62":function(t,e,n){},a5e8:function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("page",[n("div",{staticStyle:{"margin-bottom":"30px"}},[n("el-button",{attrs:{type:"primary",loading:t.start,disabled:t.start},on:{click:t.getZuowenLastId}},[t._v("同步数据")]),n("el-button",{attrs:{plain:""},on:{click:t.playFunc}},[t._v(t._s(t.play?"暂停":"开始"))]),n("span",{staticClass:"progress"},[t._v(" 成功 "),n("span",[t._v(t._s(t.succ))]),t._v(" 条，失败 "),n("span",[t._v(t._s(t.error))]),t._v(" 条 ")]),t._v(" > ")],1),n("common-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],attrs:{data:t.list,headers:t.headers,paging:!0,"total-num":t.total,"page-num":t.page,"size-num":t.limit},on:{"update:pageNum":function(e){t.page=e},"update:page-num":function(e){t.page=e},"update:sizeNum":function(e){t.limit=e},"update:size-num":function(e){t.limit=e},callback:t.getZuowenList},scopedSlots:t._u([{key:"operation",fn:function(e){var a=e.row;return[n("el-button",{staticClass:"btn-delete",attrs:{type:"text"},on:{click:function(e){return t.link(a.zuowen_id)}}},[t._v("详情")])]}}])})],1)},r=[],o=(n("b64b"),n("96cf"),n("1da1")),i=n("b775"),u=n("4328"),s=n.n(u);function c(t,e){return Object(i["a"])({url:"/api/zuowen/sync",method:"post",params:t,data:e})}function l(t,e){return Object(i["a"])({url:"https://api.xhzapp.com/api/v5/AppBook/GetZuoWenModel",method:"post",params:t,data:s.a.stringify(e,{allowDots:!0})})}function p(t,e){return Object(i["a"])({url:"/api/zuowen/lastid",method:"get",params:t,data:e})}function d(t,e){return Object(i["a"])({url:"/api/zuowen/list",method:"get",params:t,data:e})}var m=n("c466"),h=n("6821"),g=n.n(h),f={data:function(){return{loading:!1,list:[],headers:[{prop:"title",label:"标题"},{prop:"genre",label:"类型"},{prop:"grade",label:"所属年纪"},{prop:"theme",label:"主题"},{prop:"read_count",label:"阅读次数"},{prop:"updated_at",label:"更新时间",formatter:function(t,e,n){return Object(m["a"])(n,"YYYY-MM-DD")}}],total:0,page:1,limit:10,succ:0,error:0,start:!1,play:!0}},created:function(){this.getZuowenList()},destroyed:function(){clearTimeout(this.timeout)},methods:{link:function(t){window.open("/work/zuowenresult.html?zuowen_id="+t)},openSyncZuowen:function(){this.showAddCampus=!0},playFunc:function(){this.play=!this.play,clearTimeout(this.timeout),this.play&&this.getZuowenLastId()},getZuowenList:function(){var t=this;this.loading=!0,d({page:this.page,limit:this.limit}).then((function(e){t.loading=!1,t.list=e.data.item,t.total=e.data.total})).catch((function(){t.loading=!1}))},getZuowenLastId:function(){var t=this;this.play&&p().then((function(e){t.start=!0,t.forEachWZuoen(e.data+1)}))},forEachWZuoen:function(t){for(var e=this,n=t;n<t+20;n++)this.request({zuoWenId:n});this.getZuowenList(),this.timeout=setTimeout((function(){e.getZuowenLastId()}),3e3)},syncData:function(t){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,c({},t);case 3:e.succ++,e.succ+e.error>=20&&(e.start=!1),n.next=10;break;case 7:n.prev=7,n.t0=n["catch"](0),e.error++;case 10:case"end":return n.stop()}}),n,null,[[0,7]])})))()},objKeySort:function(t){for(var e=Object.keys(t).sort(),n={},a=0;a<e.length;a++)n[e[a]]=t[e[a]];return n},getSign:function(t){var e=g()(t.date),n=this.objKeySort(t),a="";for(var r in n)a+=n[r];a+="CVrFcVJu564ArjsShh058xSjb";var o=e.substring(0,16)+g()(a)+e.substring(16,32);return o},request:function(t){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function n(){var a,r,o,i,u,s,c,p,d;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:for(s in a=null!=t?t:{},r=Object(m["a"])((new Date).getTime()),a.date=r,console.log(a),o=e.getSign(a),a.ciphertext=o,u=[],a)a.hasOwnProperty(s)&&(i=a[s],u.push(s+"="+i));return n.next=10,l(null,a);case 10:if(c=n.sent,1!==c.code){n.next=16;break}return p=c.data,d={comments:p.comment,genre:p.genre,grade:p.grade,zuowen_id:p.id,quality:p.quality,read_count:p.readCount,theme:p.theme,title:p.title,word_number:p.wordNumber,zw_content:p.zwContent},n.next=16,e.syncData(d);case 16:case"end":return n.stop()}}),n)})))()}}},w=f,b=(n("e05c"),n("2877")),v=Object(b["a"])(w,a,r,!1,null,"7e9ae62e",null);e["default"]=v.exports},e05c:function(t,e,n){"use strict";n("9f62")}}]);